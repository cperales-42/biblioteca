<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Préstamos</title>
</head>
<body>
<h1>Lista de Préstamos</h1>

<!-- Botón solo para ADMIN -->
<a th:if="${#authorization.expression('hasRole(''ADMIN'')')}" href="/prestamos/nuevo">Nuevo Préstamo</a>

<table border="1">
    <tr>
        <th>ID</th><th>Usuario</th><th>Libro</th><th>Fecha Préstamo</th><th>Fecha Devolución</th><th>Acciones</th>
    </tr>
    <tr th:each="p : ${prestamos}">
        <td th:text="${p.idPrestamo}"></td>
        <td th:text="${p.usuario.nombre}"></td>
        <td th:text="${p.libro.titulo}"></td>
        <td th:text="${p.fechaPrestamo}"></td>
        <td th:text="${p.fechaDevolucion}"></td>
        <td>
            <!-- LECTOR solo puede devolver si es su préstamo -->
            <a th:if="${#authorization.expression('hasRole(''LECTOR'')') and p.usuario.email == #authentication.name and p.fechaDevolucion == null}"
               th:href="@{/prestamos/devolver/{id}(id=${p.idPrestamo})}">Devolver</a>

            <!-- ADMIN puede devolver cualquier préstamo -->
            <a th:if="${#authorization.expression('hasRole(''ADMIN'')') and p.fechaDevolucion == null}"
               th:href="@{/prestamos/devolver/{id}(id=${p.idPrestamo})}">Devolver</a>
        </td>
    </tr>
</table>

<a href="/index">Volver al inicio</a>
</body>
</html>
